@model SmartAdmin.Models.Vehiculo.EditVehiculoViewModel

<form id="formEditarVenta">
    <input type="hidden" id="VehiculoId" value="@Model.VehiculoId" />

    <!-- Hidden fields for non-editable data -->
    <input type="hidden" id="h_Vin" value="@Model.Vin" />
    <input type="hidden" id="h_Placa" value="@Model.Placa" />
    <input type="hidden" id="h_NumeroMotor" value="@Model.NumeroMotor" />
    <input type="hidden" id="h_NumeroChasis" value="@Model.NumeroChasis" />
    <input type="hidden" id="h_MarcaId" value="@Model.MarcaId" />
    <input type="hidden" id="h_ModeloId" value="@Model.ModeloId" />
    <input type="hidden" id="h_VersionId" value="@Model.VersionId" />
    <input type="hidden" id="h_Anio" value="@Model.Anio" />
    <input type="hidden" id="h_Color" value="@Model.Color" />
    <input type="hidden" id="h_Estado" value="@Model.Estado" />
    <input type="hidden" id="h_Procedencia" value="@Model.Procedencia" />
    <input type="hidden" id="h_NumeroImportacion" value="@Model.NumeroImportacion" />
    <input type="hidden" id="h_NumeroPoliza" value="@Model.NumeroPoliza" />
    <input type="hidden" id="h_FechaIngresoPais" value="@(Model.FechaIngresoPais?.ToString("yyyy-MM-dd"))" />
    <input type="hidden" id="h_FechaRecepcion" value="@(Model.FechaRecepcion?.ToString("yyyy-MM-dd"))" />
    <input type="hidden" id="h_CostoImportacion" value="@Model.CostoImportacion" />
    <input type="hidden" id="h_PrecioLista" value="@Model.PrecioLista" />
    <input type="hidden" id="h_KilometrajeActual" value="@Model.KilometrajeActual" />
    <input type="hidden" id="h_FechaPrimeraMatricula" value="@(Model.FechaPrimeraMatricula?.ToString("yyyy-MM-dd"))" />

    <!-- Datos Comerciales -->
    <h6 class="text-primary border-bottom pb-2 mb-3"><i class="fas fa-dollar-sign me-2"></i>Datos Comerciales</h6>
    <div class="row">
        <div class="col-md-6 mb-3">
            <label class="form-label">Cliente</label>
            <select class="form-select" id="ClienteId">
                <option value="">Sin asignar</option>
            </select>
        </div>
        <div class="col-md-6 mb-3">
            <label class="form-label">Precio de Venta</label>
            <div class="input-group">
                <span class="input-group-text">$</span>
                <input type="number" class="form-control" id="PrecioVenta" step="0.01" min="0"
                       value="@(Model.PrecioVenta?.ToString("F2"))" />
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-4 mb-3">
            <label class="form-label">Fecha de Venta</label>
            <input type="date" class="form-control" id="FechaVenta"
                   value="@(Model.FechaVenta?.ToString("yyyy-MM-dd"))" />
        </div>
        <div class="col-md-4 mb-3">
            <label class="form-label">Fecha de Entrega</label>
            <input type="date" class="form-control" id="FechaEntrega" disabled
                   value="@(Model.FechaEntrega?.ToString("yyyy-MM-dd"))" />
            <input type="hidden" id="h_FechaEntrega" value="@(Model.FechaEntrega?.ToString("yyyy-MM-dd"))" />
        </div>
        <div class="col-md-4 mb-3">
            <label class="form-label">Vendedor</label>
            <input type="text" class="form-control" disabled
                   value="@(ViewBag.VendedorNombre ?? "Sin asignar")" />
            <input type="hidden" id="h_VendedorId" value="@Model.VendedorId" />
        </div>
    </div>

    <!-- Garantía -->
    <h6 class="text-primary border-bottom pb-2 mb-3 mt-2"><i class="fas fa-shield-alt me-2"></i>Garantía</h6>
    <div class="row">
        <div class="col-md-6 mb-3">
            <label class="form-label">Garantía Hasta</label>
            <input type="date" class="form-control" id="GarantiaHasta"
                   value="@(Model.GarantiaHasta?.ToString("yyyy-MM-dd"))" />
        </div>
    </div>

    <!-- Observaciones -->
    <h6 class="text-primary border-bottom pb-2 mb-3 mt-2"><i class="fas fa-sticky-note me-2"></i>Observaciones</h6>
    <div class="row">
        <div class="col-12 mb-3">
            <textarea class="form-control" id="Observaciones" rows="2">@Model.Observaciones</textarea>
        </div>
    </div>
</form>

<div class="d-flex justify-content-end gap-2 mt-4 pt-3 border-top">
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
        <i class="fas fa-times me-1"></i> Cancelar
    </button>
    <button type="button" class="btn btn-primary" id="btnActualizarVenta" onclick="actualizarVenta()">
        <i class="fas fa-save me-1"></i> Actualizar
    </button>
</div>

<script>
    $(document).ready(function () {
        $('#ClienteId').select2({
            dropdownParent: $('.modal'),
            theme: 'bootstrap-5',
            placeholder: 'Buscar cliente...',
            allowClear: true,
            minimumInputLength: 2,
            language: { inputTooShort: () => 'Escriba al menos 2 caracteres...' },
            ajax: {
                url: '@Url.Action("Search", "Clientes")',
                dataType: 'json',
                delay: 300,
                data: function (params) { return { term: params.term }; },
                processResults: function (data) {
                    if (data.success && data.data) {
                        return {
                            results: data.data.map(c => ({
                                id: c.clienteId,
                                text: c.nombreCompleto + ' (' + (c.dni || c.rtn || c.telefono) + ')'
                            }))
                        };
                    }
                    return { results: [] };
                }
            }
        });

        @if (Model.ClienteId.HasValue)
        {
            @:var option = new Option(@Html.Raw(Json.Serialize((string)ViewBag.ClienteNombre)), '@Model.ClienteId', true, true);
            @:$('#ClienteId').append(option).trigger('change');
        }

    });
</script>
