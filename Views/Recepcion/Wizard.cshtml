@model SmartAdmin.Models.Taller.RecepcionWizardViewModel
@{
    ViewData["Title"] = "Recepcion de Vehiculo";
}

<div class="container-fluid">
    <!-- Header con info del vehiculo -->
    <div class="card mb-3 border-primary">
        <div class="card-body py-2">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <span class="badge bg-primary me-2">@Model.CodigoCita</span>
                    <strong>@Model.ClienteNombre</strong>
                    @if (!string.IsNullOrEmpty(Model.ClienteTelefono))
                    {
                        <small class="text-muted ms-2"><i class="fas fa-phone me-1"></i>@Model.ClienteTelefono</small>
                    }
                    <br>
                    <small class="text-muted">
                        <i class="fas fa-car me-1"></i>@Model.VehiculoDescripcion
                        @if (!string.IsNullOrEmpty(Model.VehiculoPlaca))
                        {
                            <span class="badge bg-secondary ms-1">@Model.VehiculoPlaca</span>
                        }
                    </small>
                </div>
                <div class="text-end">
                    <small class="d-block text-muted">@Model.TipoServicioNombre</small>
                    <small class="d-block text-muted fst-italic">@Model.MotivoVisita</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Stepper -->
    <div class="wizard-steps mb-4">
        <ul class="nav nav-pills nav-justified wizard-nav" id="wizardNav">
            <li class="nav-item">
                <a class="nav-link active" data-step="1"><span class="step-number">1</span> Entrega</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-step="2"><span class="step-number">2</span> Exterior</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-step="3"><span class="step-number">3</span> Inventario</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-step="4"><span class="step-number">4</span> Fotos</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-step="5"><span class="step-number">5</span> Firma</a>
            </li>
        </ul>
        <div class="progress mt-2" style="height:4px">
            <div class="progress-bar bg-primary" id="wizardProgress" style="width:20%"></div>
        </div>
    </div>

    <!-- Step 1: Entrega del Vehiculo -->
    <div class="wizard-step" id="step1">
        <div class="card shadow-sm">
            <div class="card-header bg-light">
                <h5 class="mb-0"><i class="fas fa-handshake me-2"></i>Entrega del Vehiculo</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="esPropietario" checked>
                                <label class="form-check-label fw-bold" for="esPropietario">El propietario entrega el vehiculo</label>
                            </div>
                        </div>

                        <!-- Cuando ES el propietario: muestra nombre del cliente (readonly) -->
                        <div id="camposPropietario">
                            <div class="mb-3">
                                <label class="form-label">Entregado por</label>
                                <input type="text" class="form-control bg-light" id="entregadoPorPropietario"
                                       value="@Model.ClienteNombre" readonly>
                                <small class="text-muted">Datos del propietario registrado</small>
                            </div>
                        </div>

                        <!-- Cuando NO es el propietario: campos editables -->
                        <div id="camposNoPropietario" style="display:none">
                            <div class="mb-3">
                                <label class="form-label fw-bold">Nombre de quien entrega</label>
                                <input type="text" class="form-control" id="entregadoPorTercero" placeholder="Nombre completo">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Relacion con el propietario</label>
                                <input type="text" class="form-control" id="relacionEntregante" placeholder="Ej: Esposo, Hijo, Conductor...">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Telefono de contacto</label>
                                <input type="tel" class="form-control" id="telefonoEntregante" placeholder="Telefono">
                            </div>
                        </div>

                        <input type="hidden" id="entregadoPor" value="@Model.ClienteNombre">
                    </div>

                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label fw-bold">Kilometraje actual</label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="kilometraje"
                                       min="@Model.KilometrajeActual" value="@Model.KilometrajeActual" required>
                                <span class="input-group-text">km</span>
                            </div>
                            <small class="text-muted">Minimo: @Model.KilometrajeActual.ToString("N0") km</small>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">Nivel de Combustible</label>
                            <div id="fuelGaugeContainer"></div>
                            <input type="hidden" id="nivelCombustible" value="50">
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Observaciones de apertura</label>
                            <textarea class="form-control" id="observacionesApertura" rows="3" placeholder="Observaciones generales..."></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Step 2: Inspeccion Exterior -->
    <div class="wizard-step" id="step2" style="display:none">
        <div class="card shadow-sm">
            <div class="card-header bg-light">
                <h5 class="mb-0"><i class="fas fa-car-crash me-2"></i>Inspeccion Exterior</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-8">
                        <p class="text-muted mb-2">Haga clic sobre el vehiculo para marcar danos.</p>
                        <div id="vehicleDiagramContainer" class="border rounded p-3 bg-white text-center" style="min-height:300px; position:relative;">
                            <!-- SVG del vehiculo se carga dinamicamente -->
                        </div>
                    </div>
                    <div class="col-md-4">
                        <h6 class="fw-bold mb-3">Danos registrados</h6>
                        <div id="listaMarkers" class="list-group">
                            <div class="text-muted text-center py-3" id="sinDanos">
                                <i class="fas fa-check-circle fa-2x mb-2 text-success"></i>
                                <p class="mb-0">Sin danos registrados</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Step 3: Inventario y Accesorios -->
    <div class="wizard-step" id="step3" style="display:none">
        <div class="card shadow-sm">
            <div class="card-header bg-light">
                <h5 class="mb-0"><i class="fas fa-clipboard-list me-2"></i>Inventario y Accesorios</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <!-- Herramientas y Seguridad -->
                    <div class="col-md-4 mb-4">
                        <h6 class="fw-bold border-bottom pb-2"><i class="fas fa-tools me-1"></i> Herramientas y Seguridad</h6>
                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input checklist-item" type="checkbox" id="chkLlantaRepuesto">
                            <label class="form-check-label" for="chkLlantaRepuesto">Llanta de repuesto</label>
                        </div>
                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input checklist-item" type="checkbox" id="chkGato">
                            <label class="form-check-label" for="chkGato">Gato</label>
                        </div>
                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input checklist-item" type="checkbox" id="chkTriangulos">
                            <label class="form-check-label" for="chkTriangulos">Triangulos de seguridad</label>
                        </div>
                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input checklist-item" type="checkbox" id="chkExtintor">
                            <label class="form-check-label" for="chkExtintor">Extintor</label>
                        </div>
                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input checklist-item" type="checkbox" id="chkHerramientas">
                            <label class="form-check-label" for="chkHerramientas">Herramientas</label>
                        </div>
                    </div>

                    <!-- Exterior -->
                    <div class="col-md-4 mb-4">
                        <h6 class="fw-bold border-bottom pb-2"><i class="fas fa-car me-1"></i> Exterior</h6>
                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input checklist-item" type="checkbox" id="chkAntena">
                            <label class="form-check-label" for="chkAntena">Antena</label>
                        </div>
                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input checklist-item" type="checkbox" id="chkEspejoIzquierdo">
                            <label class="form-check-label" for="chkEspejoIzquierdo">Espejo izquierdo</label>
                        </div>
                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input checklist-item" type="checkbox" id="chkEspejoDerecho">
                            <label class="form-check-label" for="chkEspejoDerecho">Espejo derecho</label>
                        </div>
                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input checklist-item" type="checkbox" id="chkLimpiaparabrisas">
                            <label class="form-check-label" for="chkLimpiaparabrisas">Limpiaparabrisas</label>
                        </div>
                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input checklist-item" type="checkbox" id="chkPlacaDelantera">
                            <label class="form-check-label" for="chkPlacaDelantera">Placa delantera</label>
                        </div>
                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input checklist-item" type="checkbox" id="chkPlacaTrasera">
                            <label class="form-check-label" for="chkPlacaTrasera">Placa trasera</label>
                        </div>
                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input checklist-item" type="checkbox" id="chkTapaCombustible">
                            <label class="form-check-label" for="chkTapaCombustible">Tapa de combustible</label>
                        </div>
                    </div>

                    <!-- Interior + Documentos -->
                    <div class="col-md-4 mb-4">
                        <h6 class="fw-bold border-bottom pb-2"><i class="fas fa-couch me-1"></i> Interior y Documentos</h6>
                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input checklist-item" type="checkbox" id="chkRadio">
                            <label class="form-check-label" for="chkRadio">Radio / Sistema de audio</label>
                        </div>
                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input checklist-item" type="checkbox" id="chkTapetes">
                            <label class="form-check-label" for="chkTapetes">Tapetes</label>
                        </div>
                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input checklist-item" type="checkbox" id="chkManualVehiculo">
                            <label class="form-check-label" for="chkManualVehiculo">Manual del vehiculo</label>
                        </div>
                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input checklist-item" type="checkbox" id="chkSegundaLlave">
                            <label class="form-check-label" for="chkSegundaLlave">Segunda llave</label>
                        </div>

                        <h6 class="fw-bold border-bottom pb-2 mt-4"><i class="fas fa-engine me-1"></i> Motor</h6>
                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input checklist-item" type="checkbox" id="chkNivelAceiteOk">
                            <label class="form-check-label" for="chkNivelAceiteOk">Nivel de aceite OK</label>
                        </div>
                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input checklist-item" type="checkbox" id="chkNivelRefrigeranteOk">
                            <label class="form-check-label" for="chkNivelRefrigeranteOk">Nivel de refrigerante OK</label>
                        </div>
                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input checklist-item" type="checkbox" id="chkNivelLiquidoFrenosOk">
                            <label class="form-check-label" for="chkNivelLiquidoFrenosOk">Liquido de frenos OK</label>
                        </div>
                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input checklist-item" type="checkbox" id="chkBateriaOk">
                            <label class="form-check-label" for="chkBateriaOk">Bateria OK</label>
                        </div>
                    </div>
                </div>

                <!-- Ruedas -->
                <hr>
                <h6 class="fw-bold mb-3"><i class="fas fa-circle-notch me-1"></i> Inspeccion de Ruedas</h6>
                <div class="row justify-content-center">
                    <div class="col-md-10">
                        <div class="row">
                            <div class="col-6 col-md-3 mb-3">
                                <div class="card border text-center">
                                    <div class="card-header bg-light py-1"><small class="fw-bold">Frontal Izq.</small></div>
                                    <div class="card-body p-2">
                                        <label class="form-label small">Llanta</label>
                                        <select class="form-select form-select-sm rueda-estado" data-pos="FI" data-tipo="llanta">
                                            <option value="3">Bueno</option>
                                            <option value="2">Regular</option>
                                            <option value="1">Malo</option>
                                        </select>
                                        <label class="form-label small mt-1">Rin</label>
                                        <select class="form-select form-select-sm rueda-estado" data-pos="FI" data-tipo="rin">
                                            <option value="3">Bueno</option>
                                            <option value="2">Regular</option>
                                            <option value="1">Malo</option>
                                        </select>
                                        <div class="form-check mt-1">
                                            <input class="form-check-input rueda-check" type="checkbox" data-pos="FI" data-tipo="tuercas" checked>
                                            <label class="form-check-label small">Tuercas</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input rueda-check" type="checkbox" data-pos="FI" data-tipo="copa" checked>
                                            <label class="form-check-label small">Copa</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6 col-md-3 mb-3">
                                <div class="card border text-center">
                                    <div class="card-header bg-light py-1"><small class="fw-bold">Frontal Der.</small></div>
                                    <div class="card-body p-2">
                                        <label class="form-label small">Llanta</label>
                                        <select class="form-select form-select-sm rueda-estado" data-pos="FD" data-tipo="llanta">
                                            <option value="3">Bueno</option>
                                            <option value="2">Regular</option>
                                            <option value="1">Malo</option>
                                        </select>
                                        <label class="form-label small mt-1">Rin</label>
                                        <select class="form-select form-select-sm rueda-estado" data-pos="FD" data-tipo="rin">
                                            <option value="3">Bueno</option>
                                            <option value="2">Regular</option>
                                            <option value="1">Malo</option>
                                        </select>
                                        <div class="form-check mt-1">
                                            <input class="form-check-input rueda-check" type="checkbox" data-pos="FD" data-tipo="tuercas" checked>
                                            <label class="form-check-label small">Tuercas</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input rueda-check" type="checkbox" data-pos="FD" data-tipo="copa" checked>
                                            <label class="form-check-label small">Copa</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6 col-md-3 mb-3">
                                <div class="card border text-center">
                                    <div class="card-header bg-light py-1"><small class="fw-bold">Trasera Izq.</small></div>
                                    <div class="card-body p-2">
                                        <label class="form-label small">Llanta</label>
                                        <select class="form-select form-select-sm rueda-estado" data-pos="TI" data-tipo="llanta">
                                            <option value="3">Bueno</option>
                                            <option value="2">Regular</option>
                                            <option value="1">Malo</option>
                                        </select>
                                        <label class="form-label small mt-1">Rin</label>
                                        <select class="form-select form-select-sm rueda-estado" data-pos="TI" data-tipo="rin">
                                            <option value="3">Bueno</option>
                                            <option value="2">Regular</option>
                                            <option value="1">Malo</option>
                                        </select>
                                        <div class="form-check mt-1">
                                            <input class="form-check-input rueda-check" type="checkbox" data-pos="TI" data-tipo="tuercas" checked>
                                            <label class="form-check-label small">Tuercas</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input rueda-check" type="checkbox" data-pos="TI" data-tipo="copa" checked>
                                            <label class="form-check-label small">Copa</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6 col-md-3 mb-3">
                                <div class="card border text-center">
                                    <div class="card-header bg-light py-1"><small class="fw-bold">Trasera Der.</small></div>
                                    <div class="card-body p-2">
                                        <label class="form-label small">Llanta</label>
                                        <select class="form-select form-select-sm rueda-estado" data-pos="TD" data-tipo="llanta">
                                            <option value="3">Bueno</option>
                                            <option value="2">Regular</option>
                                            <option value="1">Malo</option>
                                        </select>
                                        <label class="form-label small mt-1">Rin</label>
                                        <select class="form-select form-select-sm rueda-estado" data-pos="TD" data-tipo="rin">
                                            <option value="3">Bueno</option>
                                            <option value="2">Regular</option>
                                            <option value="1">Malo</option>
                                        </select>
                                        <div class="form-check mt-1">
                                            <input class="form-check-input rueda-check" type="checkbox" data-pos="TD" data-tipo="tuercas" checked>
                                            <label class="form-check-label small">Tuercas</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input rueda-check" type="checkbox" data-pos="TD" data-tipo="copa" checked>
                                            <label class="form-check-label small">Copa</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Step 4: Fotos -->
    <div class="wizard-step" id="step4" style="display:none">
        <div class="card shadow-sm">
            <div class="card-header bg-light">
                <h5 class="mb-0"><i class="fas fa-camera me-2"></i>Registro Fotografico</h5>
            </div>
            <div class="card-body">
                <p class="text-muted mb-3">Toque para tomar foto con la camara o seleccione desde galeria.</p>
                <div class="row" id="fotosContainer">
                    <div class="col-md-4 col-lg-3 mb-3" data-tipo="FotoFrontal">
                        <div class="card border h-100">
                            <div class="card-header bg-light py-1 text-center"><small class="fw-bold">Frontal <span class="text-danger">*</span></small></div>
                            <div class="card-body p-2 text-center foto-dropzone" data-tipo="FotoFrontal">
                                <div class="foto-placeholder">
                                    <i class="fas fa-camera fa-2x text-muted mb-1"></i>
                                    <p class="small text-muted mb-0">Tomar foto</p>
                                </div>
                                <div class="foto-preview" style="display:none"></div>
                                <input type="file" accept="image/*" capture="environment" class="foto-input d-none" data-tipo="FotoFrontal">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 col-lg-3 mb-3" data-tipo="FotoTrasera">
                        <div class="card border h-100">
                            <div class="card-header bg-light py-1 text-center"><small class="fw-bold">Trasera <span class="text-danger">*</span></small></div>
                            <div class="card-body p-2 text-center foto-dropzone" data-tipo="FotoTrasera">
                                <div class="foto-placeholder">
                                    <i class="fas fa-camera fa-2x text-muted mb-1"></i>
                                    <p class="small text-muted mb-0">Tomar foto</p>
                                </div>
                                <div class="foto-preview" style="display:none"></div>
                                <input type="file" accept="image/*" capture="environment" class="foto-input d-none" data-tipo="FotoTrasera">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 col-lg-3 mb-3" data-tipo="FotoLateralIzq">
                        <div class="card border h-100">
                            <div class="card-header bg-light py-1 text-center"><small class="fw-bold">Lateral Izq. <span class="text-danger">*</span></small></div>
                            <div class="card-body p-2 text-center foto-dropzone" data-tipo="FotoLateralIzq">
                                <div class="foto-placeholder">
                                    <i class="fas fa-camera fa-2x text-muted mb-1"></i>
                                    <p class="small text-muted mb-0">Tomar foto</p>
                                </div>
                                <div class="foto-preview" style="display:none"></div>
                                <input type="file" accept="image/*" capture="environment" class="foto-input d-none" data-tipo="FotoLateralIzq">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 col-lg-3 mb-3" data-tipo="FotoLateralDer">
                        <div class="card border h-100">
                            <div class="card-header bg-light py-1 text-center"><small class="fw-bold">Lateral Der. <span class="text-danger">*</span></small></div>
                            <div class="card-body p-2 text-center foto-dropzone" data-tipo="FotoLateralDer">
                                <div class="foto-placeholder">
                                    <i class="fas fa-camera fa-2x text-muted mb-1"></i>
                                    <p class="small text-muted mb-0">Tomar foto</p>
                                </div>
                                <div class="foto-preview" style="display:none"></div>
                                <input type="file" accept="image/*" capture="environment" class="foto-input d-none" data-tipo="FotoLateralDer">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 col-lg-3 mb-3" data-tipo="FotoInterior">
                        <div class="card border h-100">
                            <div class="card-header bg-light py-1 text-center"><small class="fw-bold">Interior <span class="text-danger">*</span></small></div>
                            <div class="card-body p-2 text-center foto-dropzone" data-tipo="FotoInterior">
                                <div class="foto-placeholder">
                                    <i class="fas fa-camera fa-2x text-muted mb-1"></i>
                                    <p class="small text-muted mb-0">Tomar foto</p>
                                </div>
                                <div class="foto-preview" style="display:none"></div>
                                <input type="file" accept="image/*" capture="environment" class="foto-input d-none" data-tipo="FotoInterior">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 col-lg-3 mb-3" data-tipo="FotoTablero">
                        <div class="card border h-100">
                            <div class="card-header bg-light py-1 text-center"><small class="fw-bold">Tablero <span class="text-danger">*</span></small></div>
                            <div class="card-body p-2 text-center foto-dropzone" data-tipo="FotoTablero">
                                <div class="foto-placeholder">
                                    <i class="fas fa-camera fa-2x text-muted mb-1"></i>
                                    <p class="small text-muted mb-0">Tomar foto</p>
                                </div>
                                <div class="foto-preview" style="display:none"></div>
                                <input type="file" accept="image/*" capture="environment" class="foto-input d-none" data-tipo="FotoTablero">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 col-lg-3 mb-3" data-tipo="FotoDano">
                        <div class="card border h-100">
                            <div class="card-header bg-light py-1 text-center"><small class="fw-bold">Danos</small></div>
                            <div class="card-body p-2 text-center foto-dropzone" data-tipo="FotoDano" data-multiple="true">
                                <div class="foto-placeholder">
                                    <i class="fas fa-camera-retro fa-2x text-muted mb-1"></i>
                                    <p class="small text-muted mb-0">Tomar fotos (multiple)</p>
                                </div>
                                <div class="foto-preview" style="display:none"></div>
                                <input type="file" accept="image/*" capture="environment" multiple class="foto-input d-none" data-tipo="FotoDano">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Step 5: Firma y Confirmacion -->
    <div class="wizard-step" id="step5" style="display:none">
        <div class="row">
            <!-- Resumen -->
            <div class="col-md-6 mb-3">
                <div class="card shadow-sm h-100">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="fas fa-list-check me-2"></i>Resumen</h5>
                    </div>
                    <div class="card-body" id="resumenContainer">
                        <!-- Se llena dinamicamente -->
                    </div>
                </div>
            </div>
            <!-- Firma -->
            <div class="col-md-6 mb-3">
                <div class="card shadow-sm h-100">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="fas fa-signature me-2"></i>Firma del Cliente</h5>
                    </div>
                    <div class="card-body text-center">
                        <p class="text-muted mb-2">El cliente debe firmar aqui para confirmar la recepcion.</p>
                        <div class="border rounded mb-2" style="background:#fafafa">
                            <canvas id="signatureCanvas" width="500" height="200" style="width:100%;height:200px;cursor:crosshair"></canvas>
                        </div>
                        <button type="button" class="btn btn-outline-secondary btn-sm" id="btnLimpiarFirma">
                            <i class="fas fa-eraser me-1"></i>Limpiar firma
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="mb-3">
            <label class="form-label">Observaciones generales</label>
            <textarea class="form-control" id="observacionesGenerales" rows="2" placeholder="Observaciones adicionales..."></textarea>
        </div>
    </div>

    <!-- Navigation Buttons -->
    <div class="d-flex justify-content-between mt-4 mb-5">
        <a href="@Url.Action("Index", "Agenda")" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-1"></i>Cancelar
        </a>
        <div>
            <button id="btnAnterior" class="btn btn-secondary" style="display:none">
                <i class="fas fa-chevron-left me-1"></i>Anterior
            </button>
            <button id="btnSiguiente" class="btn btn-primary">
                Siguiente <i class="fas fa-chevron-right ms-1"></i>
            </button>
            <button id="btnFinalizar" class="btn btn-success" style="display:none">
                <i class="fas fa-check me-1"></i>Completar Recepcion
            </button>
        </div>
    </div>
</div>

<!-- Modal para agregar dano -->
<div class="modal fade" id="modalDano" tabindex="-1">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <h6 class="modal-title">Registrar Dano</h6>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Tipo de dano</label>
                    <select class="form-select" id="tipoDano">
                        <option value="1">Golpe</option>
                        <option value="2">Rayadura</option>
                        <option value="3">Abolladura</option>
                        <option value="4">Faltante</option>
                        <option value="5">Rotura</option>
                        <option value="99">Otro</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">Descripcion</label>
                    <input type="text" class="form-control" id="descripcionDano" placeholder="Descripcion breve...">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary btn-sm" id="btnConfirmarDano">Agregar</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
<style>
    .wizard-nav .nav-link {
        color: #6c757d;
        border-radius: 0;
        border-bottom: 3px solid transparent;
        padding: 8px 12px;
        font-size: 0.85rem;
    }
    .wizard-nav .nav-link.active {
        color: #0d6efd;
        background: transparent;
        border-bottom-color: #0d6efd;
        font-weight: 600;
    }
    .wizard-nav .nav-link.completed {
        color: #198754;
        border-bottom-color: #198754;
    }
    .step-number {
        display: inline-block;
        width: 22px;
        height: 22px;
        line-height: 22px;
        text-align: center;
        border-radius: 50%;
        background: #dee2e6;
        color: #fff;
        font-size: 0.75rem;
        margin-right: 4px;
    }
    .nav-link.active .step-number { background: #0d6efd; }
    .nav-link.completed .step-number { background: #198754; }

    .foto-dropzone {
        cursor: pointer;
        min-height: 120px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background-color 0.2s;
    }
    .foto-dropzone:hover,
    .foto-dropzone.drag-over { background-color: rgba(13,110,253,0.05); }
    .foto-preview img {
        max-width: 100%;
        max-height: 100px;
        border-radius: 4px;
    }
    .foto-preview .foto-item {
        display: inline-block;
        position: relative;
        margin: 2px;
    }
    .foto-preview .foto-remove {
        position: absolute;
        top: -6px;
        right: -6px;
        background: #dc3545;
        color: white;
        border: none;
        border-radius: 50%;
        width: 18px;
        height: 18px;
        font-size: 10px;
        line-height: 18px;
        padding: 0;
        cursor: pointer;
    }

    .damage-marker {
        position: absolute;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        
        border: 2px solid white;
        transform: translate(-50%, -50%);
        cursor: pointer;
        z-index: 10;
        box-shadow: 0 1px 3px rgba(0,0,0,0.3);
    }
</style>

<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
<script>
    const WIZARD_DATA = {
        citaId: @Model.CitaId,
        kilometrajeActual: @Model.KilometrajeActual,
        segmentoVehiculo: @Model.SegmentoVehiculo,
        clienteNombre: '@Html.Raw(Model.ClienteNombre.Replace("'", "\\'"))'
    };
    const URLS = {
        iniciarRecepcion: '@Url.Action("IniciarRecepcion", "Recepcion")',
        subirEvidencia: '@Url.Action("SubirEvidencia", "Recepcion")',
        volverAgenda: '@Url.Action("Index", "Agenda")'
    };
</script>
<script src="~/JS/components/vehicle-diagram.js"></script>
<script src="~/JS/components/fuel-gauge.js"></script>
<script src="~/JS/pages/recepcion-wizard.js"></script>
}
