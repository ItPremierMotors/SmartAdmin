@model SmartAdmin.Models.Taller.CitaViewModel

<div class="alert alert-info mb-3">
    <i class="fas fa-info-circle me-1"></i>
    El vehiculo permanecera en taller. Se creara una nueva cita para manana con los minutos pendientes.
</div>

<div class="card mb-3">
    <div class="card-body">
        <table class="table table-sm table-borderless mb-0">
            <tr>
                <td class="text-muted" style="width:40%">Cita:</td>
                <td class="fw-bold"><code>@Model.CodigoCita</code></td>
            </tr>
            <tr>
                <td class="text-muted">Cliente:</td>
                <td>@Model.ClienteNombre</td>
            </tr>
            <tr>
                <td class="text-muted">Vehiculo:</td>
                <td>@Model.VehiculoDescripcion</td>
            </tr>
            <tr>
                <td class="text-muted">Servicio:</td>
                <td>@Model.TipoServicioNombre</td>
            </tr>
            <tr>
                <td class="text-muted">Duracion Total:</td>
                <td><strong>@Model.DuracionMinutos min</strong></td>
            </tr>
        </table>
    </div>
</div>

<form id="formTransferirCita">
    <input type="hidden" id="TransferirCitaId" value="@Model.CitaId" />
    <div class="mb-3">
        <label class="form-label fw-bold">Minutos trabajados hoy <span class="text-danger">*</span></label>
        <input type="number" class="form-control" id="TransferirMinutosTrabajados"
               min="1" max="@(Model.DuracionMinutos - 1)" value="@(Model.DuracionMinutos / 2)" required />
        <small class="text-muted">Maximo: @(Model.DuracionMinutos - 1) min (debe quedar al menos 1 min pendiente)</small>
    </div>
    <div class="mb-3">
        <label class="form-label text-muted">Minutos pendientes para manana:</label>
        <div class="fs-5 fw-bold text-primary" id="minutosPendientes">
            @(Model.DuracionMinutos - Model.DuracionMinutos / 2) min
        </div>
    </div>
</form>

<div class="d-flex justify-content-end gap-2 mt-3 pt-3 border-top">
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
    <button type="button" class="btn btn-primary" id="btnTransferir" onclick="confirmarTransferirCita()">
        <i class="fas fa-exchange-alt me-1"></i> Transferir a Manana
    </button>
</div>

<script>
    $(document).ready(function () {
        const duracionTotal = @Model.DuracionMinutos;
        $('#TransferirMinutosTrabajados').on('input', function () {
            const trabajados = parseInt($(this).val()) || 0;
            const pendientes = duracionTotal - trabajados;
            $('#minutosPendientes').text(pendientes > 0 ? pendientes + ' min' : '---');
        });
    });
</script>
