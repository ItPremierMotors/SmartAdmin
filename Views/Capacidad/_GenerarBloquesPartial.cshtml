@{
    var capacidadId = (int)ViewBag.CapacidadId;
}

<div class="alert alert-info mb-3">
    <i class="fas fa-info-circle me-1"></i>
    Se generaran bloques horarios automaticamente segun la configuracion indicada.
</div>

<form id="formGenerarBloques">
    <input type="hidden" id="BloquesCapacidadId" value="@capacidadId" />

    <div class="row">
        <div class="col-md-6 mb-3">
            <label class="form-label">Hora Inicio Jornada <span class="text-danger">*</span></label>
            <input type="time" class="form-control" id="BloquesHoraInicio" value="08:00" required />
        </div>
        <div class="col-md-6 mb-3">
            <label class="form-label">Hora Fin Jornada <span class="text-danger">*</span></label>
            <input type="time" class="form-control" id="BloquesHoraFin" value="17:00" required />
        </div>
    </div>

    <div class="row">
        <div class="col-md-6 mb-3">
            <label class="form-label">Duracion por Bloque (min) <span class="text-danger">*</span></label>
            <select class="form-select" id="BloquesDuracion" required>
                <option value="30">30 minutos</option>
                <option value="60" selected>60 minutos (1 hora)</option>
                <option value="90">90 minutos</option>
                <option value="120">120 minutos (2 horas)</option>
            </select>
        </div>
        <div class="col-md-6 mb-3">
            <label class="form-label">Vehiculos por Bloque <span class="text-danger">*</span></label>
            <input type="number" class="form-control" id="BloquesCapacidad" min="1" max="20" value="2" required />
        </div>
    </div>

    <div class="mb-3">
        <label class="form-label">Tipo de Bloque <span class="text-danger">*</span></label>
        <select class="form-select" id="BloquesTipo" required>
            <option value="1" selected>Estandar</option>
            <option value="2">Rapido</option>
            <option value="3">Colision / Pintura</option>
        </select>
    </div>

    <div class="bg-light rounded p-3 mb-3">
        <small class="text-muted">
            <i class="fas fa-calculator me-1"></i>
            Bloques estimados: <strong id="bloquesEstimados">9</strong>
            | Capacidad total: <strong id="capacidadTotal">18</strong> vehiculos
        </small>
    </div>
</form>

<div class="d-flex justify-content-end gap-2 mt-4 pt-3 border-top">
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
        <i class="fas fa-times me-1"></i> Cancelar
    </button>
    <button type="button" class="btn btn-primary" id="btnGenerarBloques" onclick="confirmarGenerarBloques()">
        <i class="fas fa-magic me-1"></i> Generar Bloques
    </button>
</div>

<script>
    $(document).ready(function () {
        calcularEstimados();
        $('#BloquesHoraInicio, #BloquesHoraFin, #BloquesDuracion, #BloquesCapacidad').on('change input', calcularEstimados);
    });

    function calcularEstimados() {
        const inicio = $('#BloquesHoraInicio').val();
        const fin = $('#BloquesHoraFin').val();
        const duracion = parseInt($('#BloquesDuracion').val()) || 60;
        const capacidad = parseInt($('#BloquesCapacidad').val()) || 1;

        if (inicio && fin) {
            const [hi, mi] = inicio.split(':').map(Number);
            const [hf, mf] = fin.split(':').map(Number);
            const totalMin = (hf * 60 + mf) - (hi * 60 + mi);
            const bloques = Math.max(0, Math.floor(totalMin / duracion));
            $('#bloquesEstimados').text(bloques);
            $('#capacidadTotal').text(bloques * capacidad);
        }
    }
</script>
